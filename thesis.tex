% **************************************************
% Document Class Definition
% **************************************************
\documentclass[%
	paper=A4,					% paper size --> A4 is default in Germany
	twoside=true,				% onesite or twoside printing
	openright,			.
	% doublepage cleaning ends up right side
	parskip=full,				% spacing value / method for paragraphs
	chapterprefix=true,			% prefix for chapter marks
	11pt,						% font size
	headings=normal,			% size of headings
	bibliography=totoc,			% include bib in toc
	listof=totoc,				% include listof entries in toc
	titlepage=on,				% own page for each title page
	captions=tableabove,		% display table captions above the float env
	draft=true,				% value for draft version
]{scrreprt}%

% **************************************************
% Debug LaTeX Information
% **************************************************
%\listfiles

% **************************************************
% Information and Commands for Reuse
% **************************************************
\newcommand{\thesisTitle}{Compliant Humanoid Robots:\\Simulation and Control}
\newcommand{\thesisName}{Alessio Rocchi}
\newcommand{\thesisSubject}{Robust Control Framework  and Simulation Techniques for Compliant Humanoid Robots with application to the Darpa Robotics Challenge}
\newcommand{\thesisDate}{11 November, 2015}
\newcommand{\thesisVersion}{Draft}

\newcommand{\thesisFirstReviewer}{Nikos G. Tsagarakis}
\newcommand{\thesisFirstReviewerUniversity}{\protect{Istituto Italiano di Tecnologia}}
\newcommand{\thesisFirstReviewerDepartment}{Advanced Robotics Department}

\newcommand{\thesisSecondReviewer}{Antonio Bicchi}
\newcommand{\thesisSecondReviewerUniversity}{\protect{Universit\`a di Pisa}}
\newcommand{\thesisSecondReviewerDepartment}{Centro E. Piaggio}

\newcommand{\thesisFirstSupervisor}{Nikos G. Tsagarakis}
\newcommand{\thesisSecondSupervisor}{Antonio Bicchi}

\newcommand{\thesisUniversity}{\protect{Universit\`a di Genova}}
\newcommand{\thesisUniversityDepartment}{Advanced Robotics Department}
\newcommand{\thesisUniversityInstitute}{Istituto Italiano di Tecnologia}
\newcommand{\thesisUniversityGroup}{Clean Thesis Group (CTG)}
\newcommand{\thesisUniversityCity}{Genova}
\newcommand{\thesisUniversityStreetAddress}{via Morego 30}
\newcommand{\thesisUniversityPostalCode}{16163}

% **************************************************
% Load and Configure Packages
% **************************************************
\usepackage[utf8]{inputenc}		% defines file's character encoding
\usepackage[english]{babel} % babel system, adjust the language of the content
\usepackage[					% clean thesis style
	figuresep=colon,%
	sansserif=false,%
	hangfigurecaption=false,%
	hangsection=true,%
	hangsubsection=true,%
	colorize=full,%
	colortheme=bluemagenta,%
	bibsys=bibtex,%
	bibfile=bib/refs,%
	bibstyle=alphabetic,%
]{cleanthesis}
\usepackage{amsmath, amssymb, bm}
\usepackage{comment}
\usepackage{graphicx, epsfig}
\usepackage{caption, subcaption, wrapfig}
\usepackage{array, makecell, multicol}
\usepackage[toc,page]{appendix}
\usepackage{rotating}
\usepackage[draft]{todonotes}

\hypersetup{					% setup the hyperref-package options
	pdftitle={\thesisTitle},	% 	- title (PDF meta)
	pdfsubject={\thesisSubject},% 	- subject (PDF meta)
	pdfauthor={\thesisName},	% 	- author (PDF meta)
	plainpages=false,			% 	-
	colorlinks=false,			% 	- colorize links?
	pdfborder={0 0 0},			% 	-
	breaklinks=true,			% 	- allow line break inside links
	bookmarksnumbered=true,		%
	bookmarksopen=true			%
}

% **************************************************
% Document CONTENT
% **************************************************
\begin{document}

% --------------------------
% rename document parts
% --------------------------
%\renewcaptionname{ngerman}{\figurename}{Abb.}
%\renewcaptionname{ngerman}{\tablename}{Tab.}
\renewcaptionname{english}{\figurename}{Fig.}
\renewcaptionname{english}{\tablename}{Tab.}

% --------------------------
% Front matter
% --------------------------
\pagenumbering{roman}			% roman page numbing (invisible for empty page style)
\pagestyle{empty}				% no header or footers
\input{content/titlepages}		% INCLUDE: all titlepages
\cleardoublepage

\pagestyle{plain}				% display just page numbers
\input{content/abstract}		% INCLUDE: the abstracts (english and german)
\cleardoublepage
%
\input{content/acknowledgement} % INCLUDE: acknowledgement
\cleardoublepage
%
\setcounter{tocdepth}{2}		% define depth of toc
\tableofcontents				% display table of contents
\cleardoublepage

% --------------------------
% Body matter
% --------------------------
\pagenumbering{arabic}			% arabic page numbering
\setcounter{page}{1}			% set page counter
\pagestyle{maincontentstyle} 	% fancy header and footer

\chapter{Introduction}


\chapter{Simulation of Compliant Robots}
\input{simulator}

\chapter{Whole-Body Control}
\input{opensot}

\chapter{Humanoids Software Architecture}
\label{architecture}
\input{architecture}

\chapter{Conclusions}
In this work, part of the results of the effort on the Darpa Robotics Challenge for team WALKMAN have been presented.
Some of the results have been obtained in an attempt to engineer the state of the art in humanoid robotics.
As previously highlighted, even though the research work in the humanoid robotics field is varied and is carried over by many laboratories around the world using different approaches and different goals, one of the surprising point of the competition lie inthe fact that the solutions adopted by so many teams tended to being very similar. One could argue how this showed a significant cap put by technology on the state of the art of more basic research.

On the OpenSoT front, the experience during the development and use of the library have been very valuable:
\begin{itemize}
 \item even though a library is built with ambitious goals for flexibility, adaptability and sharability, in fact the research community is not apt to adopting standards which are built by possible competitors, unless it is addressed specifically in a formal scientific collaboration. On the other side, the ROS ecosystem over the years gained even more ground as a platform for sharing modules, and to reuse nodes to be composed in order to obtain high level, complex robotic systems. Of course,in general the community of researches expert in one field and the community of users of the products of that field belong to two different scenarios that intersect only in some circumstances. One idea for the future is to export the OpenSoT functionalities as a MoveIt plugin, in order to provide a robust whole-body framework which is ready to use for the large community of ROS users.
 \item it is very difficult among the research community to make sound statements about the robustness of software. In some cases, the software is seen as a byproduct of a theoretical development in a certain field, so that criticizing the software in terms of robustness it's often not possible or easy to do. A large part of the community can recognize a strong theoretical contribution, but fail at recognizing the value of resarch work in applied engineering. The Darpa Robotics Challenge very clearly pushed the community to distinguish the research and technology that works reliably in the physical world from that which belongs only to the lab. More and more robotics challenge are being organized early, with the hope that the community will gain more awareness and sensibility to the problem of implementing research on a physical robot.
 \item while the field of resolved velocity control is still not exhausted (see recent results in learning, task specification, robust resolved velocity  control \todo{cite Andrea}..), the next step in frameworks like OpenSoT is not strictly in control, but in sensing. Many groups work in sensing and estimation, and in order to obtain more robust control it is important to have good state observers and estimators. Our experience showed that without filtering, tools like the dynamics constraint implemented in our robots can show jittety behaviors. At the moment, the solution in this cases where good joint velocity and torque estimates was needed, was to set gains which were more forgiving, or to relax the constraints.
 \item while many might argue that different formulations of the hiearchical constrained resolved velocity control might result in an unfeasible problem, very often the unfeasibality problem ends up being a tricky design decision rather than a formulation problem. For example, even when the constraints are hard, meaning that breaking those contraints results in obtaining no solution from the IK solver, the unfeasibality problem has a physical meaning which is not just mathematical, and entails questions like: what should I do when I am sure I am going to fall, what should happen when for whichever reason I find my joints out of the designed safety limits, and what should I do when my joints are exerting torques which are greater than what I planned? In some of these cases, in our experience we kept unfeasibility by design, in some other cases we relaxed a constraint. More in practice, in OpenSoT the joint limit constraints are hard constraints, so in some circumstances, because of the compliant joints, the robot might start in a configuration from which no solution to the IK is feasible, and contingency actions can be taken after an human operator verifies the situation. On the other side, the dynamics constrained has been relaxed so as to be always feasible. In fact, the dynamics constraint is in general a \emph{repulsive} constraint, meaning that even when the solution might impose a joint to move in a certain direction, the constraint might ask the joint to move in the opposite direction. Sometimes, the speed at which we need to move is too high and goes in conflict with the joint velocity limits, making the problem unfeasible. For example, imagine having a pendulum with a heavy weight attached to its extremity, and a torque limits constraint on its joint. When the pendulum is at the configuration of maximum torque, the torque limit might ask us to accelerate downward in order to decrese the load on the motor. Still, the requested movement might be unfeasible for the joint velocity limit constraint. In a way, this highlights the need of enforcing priority even between constraints. We implemented this by relaxing the dynamics (or torque limits) constraint as to alway impose velocities which are also feasible for the higher priority constriants (which, in this case, is the joint velocity limits).
 \item while the admittance control scheme that is implemented by the \emph{Interaction} task (\ref{task:interaction}) works well in some cases, is not general enough for whole-body force control, e.g. it does not work for controlling ground reaction forces when in double support phase with no other external contacts.\todo{could be specified more clearly with grasp terminology} A more generic approach should be considered to obtain either whole-body hybrid position/force control, or force and position control through a whole-body admittance or compliance control.
 \item while task specification is relatively easy to implement, gain tuning and priority tuning is a major problem when designing a stack. Furthermore, task deseigners require in some cases stacks able perform a particular motion or a set of motions in a human-like manner, and while we can anticipate this need will become more and more significant as service robotics progresses into the house, it is difficult or impossible to design human-like motions in terms of simple cost functions and hand-tuning of gains. In the same way, it is relatively difficult to design stacks that perform well globally, or in other words, trajectories should not be generated exclusively by a local optimization method (like the one used in OpenSoT), but a planner should provide setpoints for the controller. FOr both cases, planning of the gains and priorities could be an area of work, be either by means of optimal control, sampling-based planning or machine learning techniques.
\end{itemize}
Future work for the framework might include 
\begin{itemize}
 \item minimum effort? force optimization? optimization of the posture?
\end{itemize}

On the simulation front:
\begin{itemize}
 \item 
\end{itemize}

\cleardoublepage

% --------------------------
% Back matter
% --------------------------
{%
\setstretch{1.1}
\renewcommand{\bibfont}{\normalfont\small}
\setlength{\biblabelsep}{0pt}
\setlength{\bibitemsep}{0.5\baselineskip plus 0.5\baselineskip}
\printbibliography[nottype=online]
\printbibliography[heading=subbibliography,title={Websites},type=online,prefixnumbers={@}]
}
\cleardoublepage

%\listoffigures
%\cleardoublepage

%\listoftables
%\cleardoublepage

%\input{content/colophon}
%\cleardoublepage

%\input{content/declaration}
%\clearpage
%\newpage
%\mbox{}

% **************************************************
% End of Document CONTENT
% **************************************************
\end{document}
